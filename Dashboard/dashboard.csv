import streamlit as st
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns

# Setting dasar untuk dashboard
st.set_page_config(page_title="Dashboard Penyewaan Sepeda", layout="wide")
st.title("Dashboard Penyewaan Sepeda")

# Load data
@st.cache_data  # Biar gak reload terus-terusan
def baca_data():
    path = "D:\\DBS_coding\\Bike_dashboard\\all_data.csv"  # Pastikan path benar
    df = pd.read_csv(path)
    df['dteday'] = pd.to_datetime(df['dteday'])
    df['tahun'] = df['dteday'].dt.year
    df['bulan'] = df['dteday'].dt.month
    return df

# Ambil data
data_sepeda = baca_data()

# Sidebar untuk pilih tahun dan bulan
st.sidebar.header("Filter Data")
tahun_pilihan = st.sidebar.selectbox("Pilih Tahun:", [2011, 2012], index=0)
bulan_pilihan = st.sidebar.selectbox("Pilih Bulan:", range(1, 13), format_func=lambda x: f"Bulan {x}")

# Filter data berdasarkan tahun dan bulan
data_bulanan = data_sepeda[(data_sepeda['tahun'] == tahun_pilihan) & (data_sepeda['bulan'] == bulan_pilihan)]

total_peminjaman = data_bulanan['cnt'].sum()
st.subheader(f"Total Peminjaman Sepeda di {tahun_pilihan} Bulan {bulan_pilihan}: {total_peminjaman}")

# Grafik peminjaman bulanan
st.subheader("Tren Penyewaan Sepeda per Bulan (2011-2012)")
data_perbulan = data_sepeda.groupby(['tahun', 'bulan'])['cnt'].sum().reset_index()
fig, ax = plt.subplots(figsize=(10, 5))
sns.lineplot(data=data_perbulan, x='bulan', y='cnt', hue='tahun', marker='o', ax=ax)
plt.xlabel("Bulan")
plt.ylabel("Total Penyewaan")
plt.xticks(range(1, 13))
plt.legend(title="Tahun")
st.pyplot(fig)

# Cari bulan dengan penyewaan tertinggi & terendah
st.subheader("Bulan dengan Penyewaan Terbanyak & Tersedikit")
bulan_max = data_perbulan.loc[data_perbulan['cnt'].idxmax()]
bulan_min = data_perbulan.loc[data_perbulan['cnt'].idxmin()]

col1, col2 = st.columns(2)
col1.metric("Penyewaan Tertinggi", f"{bulan_max['cnt']} sepeda", f"Pada Tahun {bulan_max['tahun']} Bulan {bulan_max['bulan']}")
col2.metric("Penyewaan Terendah", f"{bulan_min['cnt']} sepeda", f"Pada Tahun {bulan_min['tahun']} Bulan {bulan_min['bulan']}")

if __name__ == "__main__":
    st.success("Dashboard Penyewaan Sepeda Siap Digunakan!")
